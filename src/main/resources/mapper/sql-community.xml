<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.onshuu.www.community.mapper.CommuMapper">
	<select id="selectCommuList"
			resultType="com.onshuu.www.community.dto.CommuDto">
		<![CDATA[
			SELECT
				qna_num,
				qna_title,
				qna_hitCnt,
				DATE_FORMAT(qna_created_datetime, '%Y.%m.%d %H:%i:%s') AS qna_created_datetime
			FROM
				shucommu_qna
			WHERE
				qna_deleted_yn = 'N'
			ORDER BY qna_num DESC
		]]>
	</select>

	<insert id="insertCommu"
			parameterType="com.onshuu.www.community.dto.CommuDto" useGeneratedKeys="true"
			keyProperty="qna_num">
		<![CDATA[
			INSERT INTO shucommu_qna
			(
				qna_title,
				qna_input,
				qna_created_datetime,
				qna_nick
			)
			VALUES
			(
				#{qna_title},
				#{qna_input},
				NOW(),
				'admin'
			)
		]]>
	</insert>

	<select id="selectCommuDetail" parameterType="int"
			resultType="com.onshuu.www.community.dto.CommuDto">
		<![CDATA[
			SELECT
				qna_num,
				qna_title,
				qna_input,
				qna_hitCnt,
				DATE_FORMAT(qna_created_datetime, '%Y.%m.%d %H:%i:%s') AS qna_created_datetime,
				qna_nick
			FROM
				shucommu_qna
			WHERE
				qna_num = #{qna_num}
				AND qna_deleted_yn = 'N'
		]]>
	</select>

	<update id="updateHitCount" parameterType="int">
		<![CDATA[
			UPDATE
				shucommu_qna
			SET
				qna_hitCnt = qna_hitCnt + 1
			WHERE
				qna_num = #{qna_num}
		]]>
	</update>

	<update id="updateCommu"
			parameterType="com.onshuu.www.community.dto.CommuDto">
		<![CDATA[
			UPDATE shucommu_qna SET
				qna_title = #{qna_title},
				qna_input = #{qna_input},
				qna_updated_datetime = Now(),
				qna_updater_nick = 'admin'
			WHERE
				qna_num = #{qna_num}
		]]>
	</update>

	<update id="deleteCommu" parameterType="int">
		<![CDATA[
			UPDATE shucommu_qna SET
				qna_deleted_yn = 'Y',
				qna_updated_datetime = Now(),
				qna_updater_id = 'admin'
			WHERE
				qna_num = #{qna_num}
		]]>
	</update>

</mapper>